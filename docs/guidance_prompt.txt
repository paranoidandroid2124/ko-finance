Phase 5–8 Guidance
==================

1. 프로젝트 개요
- FastAPI 백엔드와 Next.js 대시보드로 구성된 K-Finance AI Research Copilot입니다.
- 핵심 도메인: 공시 기반 RAG Evidence, 플랜/결제(Toss), Admin Ops & Guardrail.
- 운영 레이어: LiteLLM, Langfuse, Celery, MinIO, Qdrant로 구성되며 Langfuse trace와 감사 로그가 모든 플로우에 연결됩니다.

2. Phase 5 핵심 목표
- 합법 데이터 정비: DART API 순정화, KOGL 필터·출처 배지 자동화, 뉴스 메타만 저장(온디맨드 요약).
- 남은 Must-Have: Toss 플랜 레이트·기능 토글(Plan tier 메시지 포함).
- Toss 결제 플랜 가드레일 강화와 운영 플로우 문서화를 통해 유료 서비스 준비.

- **진행 중**
  * Toss 플랜 레이트·기능 토글, Plan tier 커스텀 메시지 정비.
- **진행도**: 약 65%

4. Phase 6 미리보기 — “데이터 확장 & 업셀”
- 테마/섹터 워크보드(공시+뉴스+EOD), 다문서 표준질의 “질문 그리드”, 알림 룰 빌더, 리서치 메모 증거 고정.
- 공공 EOD 지표 확장, KOGL 자동 배지 확대, “근거 팩” API 베타.
- 트랜스크립트·섹터 지수·프리미엄 뉴스 벤더 PoC 계약 및 라이선스 조건 검토.

5. 컴플라이언스 & 데이터 원칙
- 무료·합법 데이터만 사용 (OpenDART API, KOGL 유형 1·3, 공개 RSS 메타).
- 공시 PDF/첨부는 내부 저장소에만 유지하고 UI에는 반드시 “출처: DART” 링크를 표시합니다.
- 뉴스 전문 저장 금지 → 메타+요약만 저장, 원문은 외부 링크로 이동.
- 라이선스 기록(`docs/phase_roadmap.md`)을 업데이트하고 RAG 응답에는 근거 문장과 링크를 필수 포함합니다.

6. 개발 지침 & 테스트
- 함수: 스네이크 케이스, 20자 이하, “동사+목적어” 구조(접속사 금지).
- 기존 훅·컴포넌트·유틸을 재사용하고 중복 코드를 피합니다.
- `pytest`만 실행하며, 프런트 테스트나 빌드가 필요하면 사용자와 협의합니다.
- 모든 문서는 UTF-8로 유지하고, 프런트 문구는 ‘친근한 사회적 기업’ 톤을 지킵니다.

7. 참고 문서
- `docs/phase_roadmap.md`: Phase 5~8 로드맵과 진행률.
- `docs/policies/news_storage_policy.md`: 뉴스 메타데이터 저장·보존 정책.
- Admin 패널/스토어 구조는 Phase 4 산출물(LLM/Guardrail/RAG/Ops/Plan)을 참고합니다.

- 뉴스 저장소 정책 변경에 맞춘 메타 전용 캐시/요약 파이프라인 배포.
- Toss 플랜 레이트/기능 토글, Plan tier 커스텀 메시지, 결제 플로 가드레일 보강.

9. 최근 완료 항목
- BigQuery 기반 재색인 SLA 대시보드 + 감사/Trace 싱크 파이프라인 정비.
- 근거 하이라이트·클릭 체인 강화 및 Admin 증거 미리보기 연동.
- Typst→LaTeX 데일리 브리프 렌더러, 증거 패키지 ZIP, MinIO/GCS 스토리지 추상화.
- 워치리스트 레이더 P1~P3 UX와 다이제스트 재전송 플로우 개선.
- 워치리스트 룰 마법사 Step 3 채널 정책 UI 고도화(Slack/Email 카드, 정책 요약, 즐겨찾기 토글).
- 룰 리스트→다이제스트 공유 버튼 및 자동 필터/채널 프리필 추가.
- 데일리 브리프 보존 루틴 및 `m4.cleanup_daily_briefs` 태스크 추가.
- KOGL 라이선스 배지·출처 표시 자동화 및 API/대시보드 반영.
- RAG 상대 날짜 질의 전처리 및 현재 날짜 메타정보 주입, 감성 메타데이터 벡터 반영.

10. 최근 업데이트 & 비고
- GCP 전환(Cloud Run, Cloud SQL, Secret Manager, Artifact Registry)은 Phase 8 범위로 유지합니다.
- Toss 결제·PlanContext·Admin 설정 충돌 여부는 정기적으로 `pytest`로 점검하고, 브라우저 테스트(`pnpm test`)는 필요 시 별도 협의합니다.
