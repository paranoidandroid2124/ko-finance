<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Watchlist Radar</title>
    <style>
      body {
        background-color: #f5f7fb;
        font-family: "Pretendard", "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
        margin: 0;
        padding: 24px 0;
        color: #101217;
      }
      .container {
        max-width: 640px;
        margin: 0 auto;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(16, 18, 23, 0.08);
        overflow: hidden;
      }
      .header {
        background: linear-gradient(120deg, #1f6feb, #6c5dd3);
        color: #ffffff;
        padding: 32px 40px 28px;
      }
      .header h1 {
        margin: 0;
        font-size: 24px;
        letter-spacing: -0.01em;
      }
      .header p {
        margin: 8px 0 0;
        font-size: 14px;
        opacity: 0.9;
      }
      .body {
        padding: 32px 40px;
      }
      .meta {
        font-size: 13px;
        color: #5a6072;
        margin-bottom: 18px;
      }
      .summary-card {
        border: 1px solid #dde1ef;
        border-radius: 10px;
        padding: 16px 20px;
        margin-bottom: 28px;
        background-color: #f8faff;
      }
      .summary-card h2 {
        margin: 0 0 12px;
        font-size: 18px;
      }
      .summary-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: 12px 20px;
        font-size: 14px;
        color: #384152;
      }
      .llm-note {
        border: 1px solid #e4e8f5;
        border-radius: 10px;
        padding: 16px 20px;
        margin-bottom: 24px;
        background-color: #ffffff;
      }
      .llm-note__label {
        font-size: 12px;
        font-weight: 600;
        letter-spacing: 0.08em;
        color: #6c5dd3;
        margin-bottom: 6px;
      }
      .llm-note p {
        margin: 0;
        font-size: 15px;
        line-height: 1.5;
        color: #2b3141;
      }
      .digest-item {
        border-bottom: 1px solid #eceff7;
        padding: 18px 0;
      }
      .digest-item:last-child {
        border-bottom: none;
      }
      .digest-item .ticker {
        font-size: 15px;
        font-weight: 600;
        color: #1f6feb;
      }
      .digest-item .headline {
        font-size: 16px;
        margin: 8px 0;
        line-height: 1.45;
      }
      .digest-item .meta-line {
        font-size: 13px;
        color: #5a6072;
      }
      .digest-item .link {
        margin-top: 6px;
        font-size: 13px;
      }
      .digest-item .link a {
        color: #1f6feb;
        text-decoration: none;
      }
      .footer {
        padding: 20px 40px 28px;
        font-size: 12px;
        color: #97a0b5;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Watchlist Radar</h1>
        <p>최근 워치리스트 경보를 요약해 제공합니다.</p>
      </div>
      <div class="body">
        <div class="meta">
          생성 시각: {{ generated_at }} · 관측 구간: {{ window_start }} ~ {{ window_end }}
        </div>
        <div class="summary-card">
          <h2>요약</h2>
          <div class="summary-metrics">
            <div>경보 {{ summary.totalDeliveries or 0 }}건</div>
            <div>이벤트 {{ summary.totalEvents or 0 }}건</div>
            <div>감시 종목 {{ summary.uniqueTickers or 0 }}개</div>
            {% if summary.topTickers %}
            <div>Top 종목: {{ summary.topTickers[:3]|join(", ") }}</div>
            {% endif %}
          </div>
        </div>
        {% if llm_overview %}
        <div class="llm-note">
          <div class="llm-note__label">LLM Insight</div>
          <p>{{ llm_overview|replace('\n', '<br />')|safe }}</p>
        </div>
        {% endif %}
        {% if llm_personal_note %}
        <div class="llm-note">
          <div class="llm-note__label">Personal Note</div>
          <p>{{ llm_personal_note|replace('\n', '<br />')|safe }}</p>
        </div>
        {% endif %}
        {% for item in items %}
        <div class="digest-item">
          <div class="ticker">{{ item.ticker or "N/A" }} · {{ item.ruleName }}</div>
          <div class="headline">
            {{ item.headline or item.summary or item.message }}
          </div>
          <div class="meta-line">
            채널: {{ item.channel }} · 유형: {{ item.eventType }}
            {% if item.category %} · 카테고리: {{ item.category }}{% endif %}
            {% if item.source %} · 출처: {{ item.source }}{% endif %}
            {% if item.sentiment is not none %} · 감성: {{ '%0.2f'|format(item.sentiment) }}{% endif %}
          </div>
          {% if item.url %}
          <div class="link">
            <a href="{{ item.url }}">원문 보기</a>
          </div>
          {% endif %}
        </div>
        {% endfor %}
        {% if not items %}
        <div class="digest-item">
          현재 워치리스트 경보가 없습니다. 워치리스트 조건을 확인해 주세요.
        </div>
        {% endif %}
      </div>
      <div class="footer">
        K-Finance AI Research Copilot · 워치리스트 레이더
      </div>
    </div>
  </body>
</html>
